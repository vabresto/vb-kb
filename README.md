# VB Knowledge Base

## Runtime status

- Canonical runtime is Python (`kb/` package, including `kb/mcp_server.py`).
- Legacy TypeScript/Cloudflare function code has been removed from this repo.
- Canonical source data lives under `data/`.

## Local setup

```bash
uv sync
```

## Command discovery

```bash
just
```

The `justfile` in the repo root lists common workflows (validation, migrations, tests, site build/serve, and MCP server commands).

## Validate data

```bash
uv run kb validate --pretty
```

Validate only changed files:

```bash
uv run kb validate --changed --pretty
```

## Run a local view-only site

```bash
uv run mkdocs serve
```

MkDocs rebuilds from `data/` and serves at `http://127.0.0.1:8000`.

## Build static output

```bash
uv run mkdocs build
```

Build output is written to `.build/site/`.

## Migrate legacy notes to v2

```bash
uv run kb migrate-notes-v2 --output-dir data
```

This creates canonical note records under `data/note/<shard>/note@<id>/index.md`.

## Run FastMCP write server

```bash
uv run kb mcp-server --transport stdio
```

For HTTP transport:

```bash
uv run kb mcp-server --transport streamable-http --host 127.0.0.1 --port 8001 --path /mcp
```

Use a shared local auth token when needed:

```bash
KB_MCP_AUTH_TOKEN=dev-secret \
uv run kb mcp-server --transport streamable-http --host 127.0.0.1 --port 8001 --path /mcp
```

## MCP auth model

- ChatGPT MCP supports OAuth2 Authorization Code + PKCE (S256) and does not support fixed API keys.
- Production ChatGPT integrations should use PKCE OAuth in front of the Python MCP endpoint.
- The in-repo write server supports an optional shared token gate (`KB_MCP_AUTH_TOKEN`) for trusted/local flows.

## Transformation layer

Source files are canonical under `data/` for v2 records (`data/person/`, `data/org/`, and `data/note/`).

The site output is generated by:

- `tools/build_site_content.py` (frontmatter/body transforms)
- `mkdocs_hooks.py` (runs transform before each MkDocs build/serve)

Edit `tools/build_site_content.py` to change how frontmatter appears on final pages.

Site styles are in `site_assets/stylesheets/kb.css`.

## Deployment notes

Python MCP deployment and auth notes are in `CLOUDFLARE_ACCESS.md`.
