# VB Knowledge Base

## Local setup

```bash
uv sync
```

## Run a local view-only site

```bash
uv run mkdocs serve
```

MkDocs rebuilds from `data-new/` for entities when present (fallback: `data/`) and serves at `http://127.0.0.1:8000`.

## Build static output

```bash
uv run mkdocs build
```

Build output is written to `site/`.

## Migrate legacy notes to v2

```bash
uv run kb migrate-notes-v2 --output-dir data-new
```

This creates canonical note records under `data-new/note/<shard>/note@<id>/index.md`.

## Run FastMCP write server

```bash
uv run kb mcp-server --transport stdio
```

For HTTP transport:

```bash
uv run kb mcp-server --transport streamable-http --host 127.0.0.1 --port 8001 --path /mcp
```

## Transformation layer

Source files are canonical under `data-new/` for v2 records (`data-new/person/`, `data-new/org/`, and `data-new/note/`). Legacy notes from `data/notes/` are migrated into `note@...` folders with canonical IDs.

The site output is generated by:

- `tools/build_site_content.py` (frontmatter/body transforms)
- `mkdocs_hooks.py` (runs transform before each MkDocs build/serve)

Edit `tools/build_site_content.py` to change how frontmatter appears on final pages.

Site styles are in `site_assets/stylesheets/kb.css`.

## Cloudflare Access

Deployment and access-control notes are in `CLOUDFLARE_ACCESS.md`.
